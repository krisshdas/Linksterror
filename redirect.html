<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advertisement - Redirecting...</title>
    
    <!-- Open Graph meta tags for social media previews -->
    <meta property="og:title" content="Check out this link!">
    <meta property="og:description" content="I'm sharing something interesting with you. Click to continue...">
    <meta property="og:image" content="https://i.imgur.com/3Q5hZ8x.png">
    <meta property="og:url" content="https://link-shortner-2898c.firebaseapp.com">
    <meta property="og:type" content="website">
    <meta property="og:site_name" content="Link Shortener">
    
    <!-- Twitter Card meta tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Check out this link!">
    <meta name="twitter:description" content="I'm sharing something interesting with you. Click to continue...">
    <meta name="twitter:image" content="https://i.imgur.com/3Q5hZ8x.png">
    <meta name="twitter:site" content="@LinkShortener">
    
    <!-- Additional meta tags -->
    <meta name="description" content="Redirecting to your destination...">
    <meta name="keywords" content="link shortener, redirect, url shortener">
    <meta name="author" content="Link Shortener">
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸ”—</text></svg>">
    
    <link rel="stylesheet" href="redirect.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <div class="loading-screen" id="loadingScreen" style="display: none;">
            <div class="loader">
                <div class="circle"></div>
                <div class="circle"></div>
                <div class="circle"></div>
            </div>
            <h2>Redirecting you to your destination</h2>
            <p>Please wait while we prepare your link...</p>
        </div>
        
        <div class="ad-container" id="adContainer">
            <div class="ad-header">
                <div class="progress-bar">
                    <div class="progress" id="progress"></div>
                </div>
                <div class="skip-ad" id="skipAd">
                    <i class="fas fa-forward"></i> Skip Ad
                </div>
            </div>
            <div class="ad-content" id="adContent">
                <h3>Please wait while we redirect you</h3>
                <p>You will be redirected to your destination shortly.</p>
                <div class="countdown-container">
                    <span id="countdown">15</span> seconds remaining
                </div>
            </div>
            <div class="ad-footer">
                <p>This advertisement helps us keep our service free</p>
            </div>
        </div>
        
        <div class="error-container" id="errorContainer" style="display: none;">
            <div class="error-icon">
                <i class="fas fa-exclamation-triangle"></i>
            </div>
            <h2 id="errorTitle">Link Not Found</h2>
            <p id="errorMessage">The link you're looking for doesn't exist or has been removed.</p>
            <a href="login.html" class="home-btn">Go to Login</a>
        </div>
    </div>
    
    <script>
        // DOM elements
        const adContainer = document.getElementById('adContainer');
        const progress = document.getElementById('progress');
        const countdown = document.getElementById('countdown');
        const skipAd = document.getElementById('skipAd');
        const errorContainer = document.getElementById('errorContainer');
        const errorTitle = document.getElementById('errorTitle');
        const errorMessage = document.getElementById('errorMessage');
        
        // Get the destination URL from sessionStorage
        const destinationUrl = sessionStorage.getItem('destinationUrl');
        
        // Countdown variables
        let countdownValue = 15;
        let countdownInterval;
        
        // Initialize the ad page
        function init() {
            if (!destinationUrl) {
                showError('Invalid Redirect', 'No destination URL provided. Please try again.');
                return;
            }
            
            // Start the countdown
            startCountdown();
            
            // Add click event to skip button
            skipAd.addEventListener('click', skipAdAndRedirect);
        }
        
        // Start the countdown
        function startCountdown() {
            countdownInterval = setInterval(() => {
                countdownValue--;
                countdown.textContent = countdownValue;
                
                // Update progress bar
                const progressPercent = ((15 - countdownValue) / 15) * 100;
                progress.style.width = progressPercent + '%';
                
                // When countdown reaches 0, redirect
                if (countdownValue <= 0) {
                    clearInterval(countdownInterval);
                    redirectToDestination();
                }
            }, 1000);
        }
        
        // Skip ad and redirect
        function skipAdAndRedirect() {
            clearInterval(countdownInterval);
            redirectToDestination();
        }
        
        // Redirect to the destination URL
        function redirectToDestination() {
            console.log("Redirecting to destination:", destinationUrl);
            window.location.href = destinationUrl;
        }
        
        // Show error page
        function showError(title = 'Link Not Found', message = 'The link you\'re looking for doesn\'t exist or has been removed.') {
            adContainer.style.display = 'none';
            errorContainer.style.display = 'block';
            errorTitle.textContent = title;
            errorMessage.textContent = message;
        }
        
        // Start the process
        init();
    </script>
</body>
</html>
